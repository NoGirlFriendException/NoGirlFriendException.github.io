<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hello, I&#39;m bb</title>
  <subtitle>Coding as Calling</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://nogirlfriendexception.github.io/"/>
  <updated>2016-07-27T02:40:01.000Z</updated>
  <id>http://nogirlfriendexception.github.io/</id>
  
  <author>
    <name>bb</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>播放器重构中遇见的坑</title>
    <link href="http://nogirlfriendexception.github.io/2016/06/06/mediaplayer-rebuild/"/>
    <id>http://nogirlfriendexception.github.io/2016/06/06/mediaplayer-rebuild/</id>
    <published>2016-06-06T10:47:30.000Z</published>
    <updated>2016-07-27T02:40:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>播放器重构中遇见的坑</p>
<p>最近一直在重构公司项目的播放器项目, 这次重构是借鉴了Bilibili开源的ijkPlayer 代码的 写法, 一个VideoView 对应各种播放器内核.<br>(android mediaplayer, exoplayer, ijkplayer.)<br>rendenview 与 Mediaplayer 层面 隔离开.</p>
<p>在开发过程中遇见了两个小坑.<br>1 简单的来说, mediaplayer 和ijkplayer 在进入Preparing的状态中时, 是不会对视频本身进行缓冲的, 而仅仅是做了初始化播放器的工作, 也就是说在prepared完成之前, 是不会有buffer的生命周期回调的, 而是在prepared 之后, 才会开始进入buffering state. 但是exoplayer的理念和 这两者有一点小小的不同,<br>exoplayer在 进入 preparing状态之后 初始化完成播放器以后,<br>会对视频本身开始buffer, buffer到足够开始进行播放以后, 才会<br>回掉 STATE_READY(Prepared)的状态.<br>这会给上层做整套生命周期 造成一定的影响.</p>
<p>如图:<br>androidmediaplayer/ ijkplayer 的初始化生命周期</p>
<p>IDLE –&gt; Preparing –&gt; Prepared –&gt; buffering –&gt; playing.</p>
<p>exoplayer的 初始化生命周期<br>IDLE –&gt; preparing –&gt; buffering –&gt; prepared(ready)</p>
<ol>
<li>onCompletion 相关<br>这三个播放器都有onCompletion的回调,这个回调其实很好理解,就是播放完成的时候会回调该生命周期,<br>但是ijkplayer回调的时机是有问题的, 它不仅仅在播放完成的时候会回调该方法,而且在出现错误的时候也会回调该方法。<br>播放器产生错误 –&gt; onError –&gt; onCompletion.</li>
</ol>
<p>我也跟IJK的作者提了<a href="https://github.com/Bilibili/ijkplayer/issues/1289" target="_blank" rel="external">issue</a>;<br>作者也承认了这个错误, 但是 not on plan.</p>
<p>不过还好 这些问题如果理解的好,可以在上层进行规避.把三套播放器的生命周期 可以整合一套的。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;播放器重构中遇见的坑&lt;/p&gt;
&lt;p&gt;最近一直在重构公司项目的播放器项目, 这次重构是借鉴了Bilibili开源的ijkPlayer 代码的 写法, 一个VideoView 对应各种播放器内核.&lt;br&gt;(android mediaplayer, exoplayer, ijkp
    
    </summary>
    
    
      <category term="Android" scheme="http://nogirlfriendexception.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>上传Android Library 到 bintray</title>
    <link href="http://nogirlfriendexception.github.io/2015/11/09/upload-androidlib-bintray/"/>
    <id>http://nogirlfriendexception.github.io/2015/11/09/upload-androidlib-bintray/</id>
    <published>2015-11-09T03:42:30.000Z</published>
    <updated>2016-07-27T02:37:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>上传Android Library 到 bintray.</p>
<p>给公司写的videoplayer模块version one 完成了, 公司两个项目都需要用到这个模块,并且其中一个项目外包出去了,所以就要把这个模块上传到一个公共的lib库,方便外包的哥们去调用. 以及后续我这边更新维护. 然后选择了上传到bintray这个网站上.</p>
<p>说实话不是太了解这块儿东西,来这个公司之前一直是闷头写代码层的东西,每天就对着svn和eclipse, 什么maven,git,As,jcenter,bintray 等等完全没接触过. 谢谢公司给了机会去学习这些,但由于英语不好,在学习使用的途中踩了很多坑.<br>这篇文章就是记录我把这个模块传到 bintray上 整个过程踩过的坑.</p>
<h1 id="第一步-注册"><a href="#第一步-注册" class="headerlink" title="第一步 注册"></a>第一步 注册</h1><p>首先你需要 去<a href="https://bintray.com/" target="_blank" rel="external">bintray官网</a> 注册个账号,这里就不过多描述了.你可以的.<br>注册完毕以后 点击这里 <img src="http://upload-images.jianshu.io/upload_images/1097102-6dfcd184ce9b8eab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>进入maven管理界面<br>然后 点击 <img src="http://upload-images.jianshu.io/upload_images/1097102-de836fe22fd42639.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>创建新的package</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1097102-ea744876bf5965e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>name 就是项目的名称<br>licenses 我选择的是apache-2.0<br>version control 我填的是github上的地址<br>然后一切ok, 点击create package. 创建完毕.</p>
<p>#第二步 寻找好用的publisher<br>作者一开始不懂这个是干什么的,是公司的cto给我推荐了1个github地址,让我去学习那个,并且告诉我这个是最简单的上传方式.<br>地址是 <a href="https://github.com/novoda/bintray-release" target="_blank" rel="external">novoda</a><br>其实英语好的哥们看到这应该已经知道怎么弄了</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1097102-bfeabd995b2e403b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>第一步 把这些配置到 你要发布的项目的 build.gradle文件中 这里需要注意的是<br>apply plugin: ‘com.novoda.bintray-release’ 这句话 需要放在com.android.library 下面<br>如图</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1097102-8ca40a91dfff276a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>第二步<br><img src="http://upload-images.jianshu.io/upload_images/1097102-7c60c4378bf4a0c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>在build.gradle 文件中添加这个方法块。<br>其中userorg 就是你的用户id<br>groupid 就是你的唯一包名<br>artifactId 是你之前最初在bintary的maven中创建的那个package的名字,这里需要对应上 否则会上传失败.<br>publishVersion 就是你的版本id咯<br>下面2个随意填了</p>
<p>第三步<br>$ ./gradlew clean build bintrayUpload -PbintrayUser=BINTRAY_USERNAME -PbintrayKey=BINTRAY_KEY -PdryRun=false<br>在命令行中输出这些,其中需要把BINTRAY_USERNAME 替换成你的bintary的名字<br>BINTRAY_KEY 替换成你的 BIntray的key ,其中key 可以点击你bintary中头像旁边的edit.<br>进入API-Key 可以看到你的key,然后 copy进来就好了！<br>这个时候打回车！ 然后就run起来了就好了.<br>上传成功以后 你可以在你bintary 那个项目中 的管理页面看到这个</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1097102-d6ad4a6950425695.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>如果看到1.0.0 恭喜你 那就是上传成功, 但是这只是1个私人的,还不能让别人都用<br>这个时候你需要点下面那个add to jcenter 然后申请加入jcenter<br>用英语写几句描述 然后 提交 然后 就耐心等待就好了！！</p>
<p>#哦 对了<br>有可能会报一个 :lint 什么什么找不到的错误 我在这卡了好一会儿.<br>需要在android中添加这么一句  如图 就是那个lintOptions什么什么的</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1097102-ddd18d7641602ae2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>哦哦我想起来了 有可能会出现什么tools.jar找不到的 bug<br>这个解决比较简单 有可能是你机器的JAVA_HOME没有指对<br>比如我是rmbp 最初的JAVA_HOME是指向的mac 自带的1.6 jdk.<br>修改成 androidstudio 指向的1.7的jdk 后就好了！！！</p>
<p>后续如果我发现有新的问题  我会后续更新这个文章</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上传Android Library 到 bintray.&lt;/p&gt;
&lt;p&gt;给公司写的videoplayer模块version one 完成了, 公司两个项目都需要用到这个模块,并且其中一个项目外包出去了,所以就要把这个模块上传到一个公共的lib库,方便外包的哥们去调用. 以及
    
    </summary>
    
    
      <category term="Android" scheme="http://nogirlfriendexception.github.io/tags/Android/"/>
    
  </entry>
  
</feed>
